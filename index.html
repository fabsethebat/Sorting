<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Storage & Grocery Manager - Improved</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(160deg, #89f7fe 0%, #66a6ff 100%);
    color: #222;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: stretch;
  }

  #container {
    max-width: 1200px;
    width: 100%;
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
  }

  /* Left side: Fridge + Grocery stacked */
  #leftSide {
    flex: 1 1 300px;
    display: flex;
    flex-direction: column;
    gap: 30px;
  }

  /* Right side: Freezers inside ring */
  #rightSide {
    flex: 1 1 300px;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 30px;
    align-items: center;
    justify-content: center;
  }

  #ring {
    border: 10px solid #4caf50;
    border-radius: 50%;
    width: 350px;
    height: 350px;
    padding: 40px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    background: white;
    box-shadow: 0 8px 30px rgba(0,0,0,0.25);
  }

  h3 {
    margin: 0 0 10px 0;
    color: #4caf50;
    font-weight: 700;
    text-align: center;
  }

  ul {
    list-style: none;
    padding: 10px;
    background: #f7f7f7;
    border-radius: 12px;
    min-height: 150px;
    max-height: 160px;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.05);
    overflow-y: auto;
    margin: 0;
  }

  li {
    padding: 8px 12px;
    margin-bottom: 8px;
    background: #fff;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    font-size: 15px;
  }

  .btn-delete {
    background: #e74c3c;
    border: none;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    padding: 4px 8px;
    font-size: 14px;
  }

  /* Middle form */
  #middleForm {
    flex: 0 0 300px;
    background: white;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    gap: 18px;
    justify-content: center;
  }

  select, input, button {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border-radius: 12px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  button {
    background: #4caf50;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  button:hover {
    background: #388e3c;
  }

  label {
    font-weight: 600;
    margin-bottom: 5px;
    color: #333;
  }

  @media (max-width: 900px) {
    #container {
      flex-direction: column;
      align-items: center;
    }
    #leftSide, #rightSide, #middleForm {
      flex: none;
      width: 100%;
      max-width: 500px;
    }
    #ring {
      width: 300px;
      height: 300px;
      padding: 30px;
    }
  }
</style>
</head>
<body>

<div id="container">

  <div id="leftSide">
    <div>
      <h3>Fridge</h3>
      <ul id="fridgeList">Loading...</ul>
    </div>
    <div>
      <h3>Grocery List</h3>
      <ul id="groceryList">Loading...</ul>
    </div>
  </div>

  <div id="middleForm">
    <label for="itemTab">Choose Storage</label>
    <select id="itemTab" aria-label="Choose storage location">
      <option value="freezer1">Freezer 1</option>
      <option value="freezer2">Freezer 2</option>
      <option value="fridge">Fridge</option>
      <option value="grocery">Grocery</option>
    </select>

    <label for="itemName">Item Name</label>
    <input type="text" id="itemName" placeholder="Enter item name" aria-label="Item name"/>

    <label for="itemSection">Shelf / Compartment</label>
    <input type="text" id="itemSection" placeholder="Optional - shelf or compartment" aria-label="Shelf or compartment" />

    <button id="addBtn" aria-label="Add item">Add Item</button>
  </div>

  <div id="rightSide">
    <div id="ring">
      <div>
        <h3>Freezer 1</h3>
        <ul id="freezer1List">Loading...</ul>
      </div>
      <div>
        <h3>Freezer 2</h3>
        <ul id="freezer2List">Loading...</ul>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Initialize Supabase client correctly
  const supabaseUrl = 'https://klpcrupzetzwtcgwqusa.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtscGNydXB6ZXR6d3RjZ3dxdXNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMTc3OTksImV4cCI6MjA3MDY5Mzc5OX0.m9SewZK1KVsPn9HysghOuGokSn5efKSK22uUJ4BocbY';

  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // Load items for a tab, render to UL with given id
  async function loadList(tab, ulId) {
    const { data, error } = await supabase
      .from('storage_items')
      .select('*')
      .eq('tab', tab)
      .order('inserted_at', { ascending: true });

    const ul = document.getElementById(ulId);
    ul.innerHTML = "";

    if (error) {
      ul.innerHTML = "<li style='color:red;'>Error loading items</li>";
      console.error(error);
      return;
    }

    if (!data.length) {
      ul.innerHTML = "<li><i>No items</i></li>";
      return;
    }

    data.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item.name + (item.section ? ` (${item.section})` : '');

      const btn = document.createElement('button');
      btn.textContent = "X";
      btn.className = "btn-delete";
      btn.title = "Delete this item";
      btn.onclick = () => deleteItem(item.id);

      li.appendChild(btn);
      ul.appendChild(li);
    });
  }

  async function loadAll() {
    await Promise.all([
      loadList('fridge', 'fridgeList'),
      loadList('grocery', 'groceryList'),
      loadList('freezer1', 'freezer1List'),
      loadList('freezer2', 'freezer2List')
    ]);
  }

  async function addItem() {
    const tab = document.getElementById('itemTab').value;
    const name = document.getElementById('itemName').value.trim();
    const section = document.getElementById('itemSection').value.trim();

    if (!name) {
      alert('Please enter an item name.');
      return;
    }

    const { error } = await supabase.from('storage_items').insert([{
      tab,
      name,
      section: section || null
    }]);

    if (error) {
      alert('Failed to add item. Check console for details.');
      console.error(error);
      return;
    }

    document.getElementById('itemName').value = '';
    document.getElementById('itemSection').value = '';
    loadAll();
  }

  async function deleteItem(id) {
    if (!confirm('Delete this item?')) return;

    const { error } = await supabase.from('storage_items').delete().eq('id', id);
    if (error) {
      alert('Failed to delete item.');
      return;
    }
    loadAll();
  }

  document.getElementById('addBtn').addEventListener('click', addItem);

  window.onload = loadAll;
</script>

</body>
</html>
